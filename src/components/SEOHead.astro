---
export interface SEOProps {
  title?: string
  description?: string
  canonical?: string
  image?: string
  type?: 'website' | 'article' | 'product'
  noindex?: boolean
  keywords?: string[]
  author?: string
  siteName?: string
  analyticsId?: string
  facebookAppId?: string
  googleSiteVerification?: string
}

interface Props extends SEOProps {}

const {
  title = 'RR Autos - Vehículos Usados de Calidad',
  description = 'Encuentra el vehículo usado perfecto para ti. Amplio catálogo de autos con garantía y financiamiento disponible. Atención personalizada con nuestros asesores expertos.',
  canonical = Astro.url.href,
  image = '/logo/logo.png',
  type = 'website',
  noindex = false,
  keywords = [
    'autos usados',
    'vehículos usados',
    'carros usados',
    'comprar auto',
    'financiamiento vehicular',
    'garantía autos',
    'RR Autos',
  ],
  author = 'RR Autos',
  siteName = 'RR Autos',
  analyticsId = import.meta.env.PUBLIC_ANALYTICS_ID,
  facebookAppId = import.meta.env.PUBLIC_FACEBOOK_APP_ID,
  googleSiteVerification = import.meta.env.PUBLIC_GOOGLE_SITE_VERIFICATION,
} = Astro.props as Props

const FALLBACK_SITE = 'https://rrautos.club'
const currentUrl = Astro.url ?? new URL(FALLBACK_SITE)
const siteOrigin = Astro.site?.origin ?? currentUrl.origin
const canonicalUrl = canonical.startsWith('http') ? canonical : new URL(canonical, siteOrigin).href
const fullTitle = title.includes('RR Autos') ? title : `${title} | RR Autos`
const imageUrl = (() => {
  try {
    return new URL(image, siteOrigin).href
  } catch {
    return image
  }
})()
const analyticsSnippet = analyticsId
  ? [
      'window.dataLayer = window.dataLayer || [];',
      'function gtag(){dataLayer.push(arguments);}',
      "gtag('js', new Date());",
      `gtag('config', '${analyticsId}', { anonymize_ip: true });`,
    ].join(' ')
  : undefined
---

<!-- Meta básicos -->
<title>{fullTitle}</title>
<meta name="description" content={description} />
<meta name="keywords" content={keywords.join(', ')} />
<meta name="author" content={author} />
<link rel="canonical" href={canonicalUrl} />

<!-- Robots -->
{noindex && <meta name="robots" content="noindex, nofollow" />}
{googleSiteVerification && <meta name="google-site-verification" content={googleSiteVerification} />}

<!-- Open Graph / Facebook -->
<meta property="og:type" content={type} />
<meta property="og:title" content={fullTitle} />
<meta property="og:description" content={description} />
<meta property="og:image" content={imageUrl} />
<meta property="og:url" content={canonicalUrl} />
<meta property="og:site_name" content={siteName} />
<meta property="og:locale" content="es_CO" />
{facebookAppId && <meta property="fb:app_id" content={facebookAppId} />}

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content={fullTitle} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={imageUrl} />

<!-- Schema.org Structured Data -->
<script
  type="application/ld+json"
  set:html={JSON.stringify({
    '@context': 'https://schema.org',
    '@type': 'AutoDealer',
    name: siteName,
    description: description,
    url: canonicalUrl,
    logo: imageUrl,
    sameAs: [
      'https://www.facebook.com/rrautos',
      'https://www.instagram.com/rrautos',
      'https://www.linkedin.com/company/rr-autos',
    ],
    address: {
      '@type': 'PostalAddress',
      addressCountry: 'CO',
      addressRegion: 'Antioquia',
      addressLocality: 'Medellín',
    },
    areaServed: {
      '@type': 'Country',
      name: 'Colombia',
    },
    telephone: '+57 300 200 6818',
    openingHoursSpecification: [
      {
        '@type': 'OpeningHoursSpecification',
        dayOfWeek: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
        opens: '09:00',
        closes: '18:00',
      },
      {
        '@type': 'OpeningHoursSpecification',
        dayOfWeek: ['Saturday'],
        opens: '09:00',
        closes: '13:00',
      },
    ],
    offers: {
      '@type': 'AggregateOffer',
      priceCurrency: 'COP',
      availability: 'https://schema.org/InStock',
    },
    potentialAction: {
      '@type': 'SearchAction',
      target: {
        '@type': 'EntryPoint',
        urlTemplate: `${canonicalUrl}?q={search_term_string}`,
      },
      'query-input': 'required name=search_term_string',
    },
  })}
/>

<!-- Analytics -->
{
  analyticsSnippet && (
    <>
      <script async src={`https://www.googletagmanager.com/gtag/js?id=${analyticsId}`} />
      <script set:html={analyticsSnippet} />
    </>
  )
}

<!-- Preconnect para mejorar performance -->
<link rel="preconnect" href="https://api-ecommerce.hostinger.com" />
<link rel="dns-prefetch" href="https://api-ecommerce.hostinger.com" />

<!-- Viewport y responsive -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

<!-- PWA Meta -->
<meta name="theme-color" content="#152238" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="apple-mobile-web-app-title" content="RR Autos" />

<!-- Performance hints -->
<link rel="prefetch" href="/vehiculos" />
