---
import Header from '../components/Header.astro'
import SEOHead, { type SEOProps } from '../components/SEOHead.astro'
import '../styles/global.css'

const DEFAULT_SEO: Required<Pick<SEOProps, 'description' | 'title'>> = {
  title: 'RR Autos - Vehículos Usados de Calidad',
  description:
    'Encuentra el vehículo usado perfecto para ti con RR Autos. Inventario curado, financiamiento flexible y asesoría personalizada para tu próxima compra.',
}

const PAGE_TITLE_SUFFIX = 'RR Autos'

const props = Astro.props as SEOProps

const seoProps: SEOProps = {
  ...DEFAULT_SEO,
  ...props,
  title: normalizeTitle(props.title ?? DEFAULT_SEO.title),
}

function normalizeTitle(rawTitle: string): string {
  const trimmed = rawTitle.trim()
  if (!trimmed) return DEFAULT_SEO.title
  return trimmed.includes(PAGE_TITLE_SUFFIX) ? trimmed : `${trimmed} | ${PAGE_TITLE_SUFFIX}`
}
---

<!doctype html>
<html lang="es" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />

    <!-- SEO y metadatos -->
    <SEOHead {...seoProps} />

    <!-- Web App Manifest -->
    <link rel="manifest" href="/manifest.json" />

    <!-- Preload critical resources -->
    <link rel="dns-prefetch" href="https://api-ecommerce.hostinger.com" />
    <link rel="preconnect" href="https://api-ecommerce.hostinger.com" crossorigin />

    <!-- Critical CSS inline para mejorar performance -->
    <style>
      /* Critical styles para evitar FOUC */
      body {
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        line-height: 1.6;
        color: var(--color-gray-800);
        background-color: var(--color-white);
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      /* Focus visible para mejor accesibilidad */
      .focus-visible {
        outline: 2px solid var(--color-primary);
        outline-offset: 2px;
      }
    </style>
  </head>
  <body>
    <!-- Skip to main content para accesibilidad -->
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-blue-600 px-4 py-2 rounded-md z-50"
    >
      Saltar al contenido principal
    </a>

    <Header />

    <main id="main-content" role="main">
      <slot />
    </main>
  </body>
</html>

<style>
  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
  }
</style>
